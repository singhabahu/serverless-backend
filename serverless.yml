service: serverless-backend

plugins:
  - serverless-webpack
  - serverless-offline #serverless-offline needs to be last in the list

provider:
  name: aws
  runtime: nodejs6.10
  role: arn:aws:iam::341025277667:role/Lambda_CognitoPowerUser
  stage: dev
  region: us-east-1
  environment:
    STAGE: ${self:provider.stage}
    USER_POOL_ID: 'us-east-1_HetaxzWw5'
    DATABASE_HOST: '52.15.81.107'
    DATABASE_USER: 'root'
    DATABASE_PASSWORD: 'password' #TODO use secret file
    DATABASE_PORT: 3306
    DATABASE_NAME: 'ovinway'
    DATABASE_DIALECT: 'mysql'
    ISS: 'https://cognito-idp.us-east-1.amazonaws.com/us-east-1_HetaxzWw5/'

functions:
  get-all-users:
    handler: 'src/api/users.all'
    events:
      - http:
          path: /users
          method: GET
          authorizer: auth
          cors: true
  get-user-details:
    handler: 'src/api/users.get'
    events:
      - http:
          path: /users/{uuid}
          method: GET
          authorizer: auth
          cors: true
  create-user:
    handler: 'src/api/users.create'
    events:
      - http:
          path: /users
          method: POST
          authorizer: auth
          cors: true
  create-project:
    handler: 'src/api/projects.create'
    events:
      - http:
          path: /projects
          method: POST
          authorizer: auth
          cors: true
  execute-post-confirm-task:
    handler: 'src/cognito/post-confimation.handler'
  auth:
    handler: 'src/api/auth.authorize'